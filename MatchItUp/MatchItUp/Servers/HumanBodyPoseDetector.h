//
//  HumanBodyPoseDetector.h
//  MatchItUp
//
//  Created by 安子和 on 2021/1/6.
//

#import <Foundation/Foundation.h>
#import <Vision/Vision.h>

NS_ASSUME_NONNULL_BEGIN

typedef NS_OPTIONS(NSUInteger, AutoRecordStage){
    Prepare         = 1,
    Tallest         = 1 << 1,
    Lowest          = 1 << 2,
    End             = 1 << 3,
    DoNoting        = 1 << 4
};

//向前挥杆准备
static double meansX_front_prepare[13] = {
    0.09273976119643611,
    0.04496039741114512,
    0.04599269537258235,
    0.05395952322816181,
    0.05826881631588486,
    0.11461305450697722,
    0.11332973304110709,
    -0.1536539425093572,
    -0.12170385797150125,
    -0.06999957508742684,
    -0.04929499276401949,
    -0.1239617434060275,
    -0.061517778986844684
};
static double meansY_front_prepare[13] = {
  -0.5,
  -0.4120093691422108,
  -0.46747470059395446,
  -0.1771491046342388,
  -0.2291346185974602,
  -0.021630361057758098,
  -0.056292044948148205,
  -0.08024030807700276,
  -0.0846825458575167,
  0.19598145053979946,
  0.1721421199638925,
  0.5413855786423584,
  0.4586144213576416
};
static double dX_front_prepare[13] = {
  0.0007033194919356416,
  0.001658720149059383,
  0.0011670975782026559,
  0.010804888005070516,
  0.0019518447819143615,
  0.005240522544587144,
  0.0021452399201733964,
  0.0010722510327317327,
  0.0025053151048636067,
  0.0027192411601466215,
  0.007043555450777235,
  0.0006177177506220397,
  0.001916864496267047
};
static double dY_front_prepare[13] = {
  6.5738408768417655e-34,
  0.0005383464238895718,
  0.0009541895789869377,
  0.005027923866192326,
  0.003950871063030577,
  0.003125032848268474,
  0.008299139616766616,
  0.001534536298345486,
  0.0009604563112596731,
  0.016717795565420294,
  0.004879087703271221,
  0.0009090845883918356,
  0.0009090845883918356
};
static double meansX_front_tallest[13] = {
  0.09816237723185567,
  -0.050277973182720585,
  0.16337855166842583,
  -0.23337512579011763,
  0.015516788703251487,
  -0.19717604434744604,
  -0.12275450790485816,
  -0.18754722038491722,
  -0.05694685598636885,
  -0.11606972421510109,
  0.0422432953892048,
  -0.14508733478751584,
  -0.05123741967619559
};
static double meansY_front_tallest[13] = {
  -0.5,
  -0.5142611580246236,
  -0.40683471003851673,
  -0.48843661366916097,
  -0.5043297482431971,
  -0.6565035359411112,
  -0.6519035845886723,
  -0.09488021756697636,
  -0.08778467272403098,
  0.21463688187224575,
  0.18662123557196603,
  0.5421610500239026,
  0.4578389499760977
};
static double dX_front_tallest[13] = {
  0.0016778026448112718,
  0.00807546641732722,
  0.009855928027799842,
  0.00935281984257374,
  0.02285796079306251,
  0.005797222833232261,
  0.007975179120240906,
  0.0017634312701266545,
  0.0020930093076114327,
  0.00474725916532457,
  0.0012916345454753344,
  0.00960669889789908,
  0.014899117097787675
};
static double dY_front_tallest[13] = {
  8.109178713209414e-34,
  0.0030255785844971145,
  0.0008608922754495318,
  0.02684344705047151,
  0.022305671630159646,
  0.03737129695351928,
  0.020159979189276395,
  0.0038256773209085874,
  0.006759689999357665,
  0.0018634375751859836,
  0.002203862038586779,
  0.0013736029583775022,
  0.0013736029583775022
};
static double meansX_front_lowest[13] = {
  0.07104785607155552,
  0.03496656026600081,
  0.010205904499097876,
  0.036811516089196326,
  0.07209307611522332,
  0.148375084337795,
  0.1463644644218763,
  -0.09358627003682432,
  -0.14098054663982004,
  -0.04054871394977147,
  -0.06842110030619475,
  -0.10033158942235866,
  -0.041764122720752375
};
static double meansY_front_lowest[13] = {
  -0.5,
  -0.4137568683063353,
  -0.5156560607372541,
  -0.19418847589005792,
  -0.28473801256281894,
  -0.0777537174613345,
  -0.13596198944135648,
  -0.08643804366213624,
  -0.0946110893528843,
  0.21069193370684647,
  0.18972106737500288,
  0.5253471901843486,
  0.47465280981565133
};
static double dX_front_lowest[13] = {
  0.0017997078341449064,
  0.0057235095168568905,
  0.00963895517720445,
  0.024630012355083088,
  0.013927789744043803,
  0.01783826798293551,
  0.004882783426547045,
  0.006384724907574924,
  0.004653330940503665,
  0.007672801414482607,
  0.005504237315468837,
  0.007037653663436138,
  0.015584355114933654
};
static double dY_front_lowest[13] = {
  6.892801906228002e-34,
  0.018011286882932746,
  0.018890074662411972,
  0.03223781480063228,
  0.023597548222437877,
  0.018660679736857227,
  0.020664012624114558,
  0.014598548076511161,
  0.013537079960070376,
  0.0063013322857410825,
  0.0027496004753297617,
  0.0012142527739537803,
  0.0012142527739537796
};
static double meansX_front_complete[13] = {
  0.03696243452322731,
  0.06604024895881519,
  -0.04645936700936598,
  -0.06400402309822258,
  -0.1989159730316178,
  -0.09157546134192186,
  -0.13350136023440046,
  -0.04151132680655107,
  -0.14368166261730506,
  -0.03568255670745902,
  -0.1287651307246249,
  0.008470963260630187,
  -0.08239583230708483
};
static double meansY_front_complete[13] = {
  -0.5,
  -0.4394797968598097,
  -0.45445230104503453,
  -0.4460443751649629,
  -0.420905612624487,
  -0.5430811285962618,
  -0.5500046374471302,
  -0.04446733024278602,
  -0.046704304841719654,
  0.20076380044106698,
  0.20556764086284005,
  0.4942562916976235,
  0.5057437083023766
};
static double dX_front_complete[13] = {
  0.00179450853968758,
  0.007058008704438661,
  0.005520065445516609,
  0.010684308586673982,
  0.015799743293299442,
  0.006793221940179325,
  0.01313119031513925,
  0.005735437306947023,
  0.007982119475237083,
  0.01192835819753788,
  0.008865183590574218,
  0.004428905222404111,
  0.004621262275165991
};
static double dY_front_complete[13] = {
  1.4380276918091361e-33,
  0.0008448933183627577,
  0.0008776300421622429,
  0.01773741162697492,
  0.010318169393438523,
  0.018172644099545825,
  0.024177297694633042,
  0.002032487969378322,
  0.0036697868122796467,
  0.04637364507294226,
  0.061836117607362934,
  0.000732360541803841,
  0.0007323605418038408
};
//向右挥杆准备动作
static double meansX_right_prepare[13] = {
  -0.01888658474456927,
  -0.14185694113037048,
  0.12973270028764164,
  -0.0683262239585533,
  0.106892511939834,
  0.013684806546666132,
  0.0663472231231584,
  -0.06244854477795249,
  0.1150647550581711,
  -0.11941630384128993,
  0.1658740970494382,
  -0.17279993907363667,
  0.21057310856277522
};
static double meansY_right_prepare[13] = {
  -0.5,
  -0.4138006448429828,
  -0.47782548303428757,
  -0.1945869884730535,
  -0.24964161789174252,
  -0.019319945739859786,
  -0.0485667292803918,
  -0.09260897880146246,
  -0.10073012678372505,
  0.20314351132179737,
  0.20079372864845124,
  0.49956374648592966,
  0.5004362535140704
};
static double dX_right_prepare[13] = {
  0.00018961489347458412,
  0.0002018245970291818,
  0.00020238950349044116,
  0.0003450411801555922,
  0.0003377293252203174,
  0.0008230042187811229,
  0.0008083925355464091,
  0.0002267391902663749,
  0.00022738827139328862,
  0.00037393630882390883,
  0.0005188116145544251,
  0.0006964271783570759,
  0.0006869722736353626
};
static double dY_right_prepare[13] = {
  1.2534866078723705e-33,
  0.00019191921851861393,
  0.00023348240905790118,
  0.00022770857499353927,
  0.0002777789005901815,
  0.000411264482591123,
  0.0008823343661926447,
  0.0003392477501947066,
  0.00034708006083790073,
  0.00022751017635328502,
  0.0002708948301848681,
  3.80499941063318e-05,
  3.804999410633192e-05
};
//向右挥杆中间动作
static double meansX_right_tallest[13] = {
  -0.03259876846627679,
  -0.10514785814347795,
  0.014523788104408483,
  -0.21453986852294593,
  -0.19755475506893624,
  -0.37853783938836283,
  -0.38396091491723905,
  -0.0597680497336993,
  0.08979301384796044,
  -0.12106527235067273,
  0.14547586918528924,
  -0.15588622530334745,
  0.22108376223590095
};
static double meansY_right_tallest[13] = {
  -0.5,
  -0.4857340921416964,
  -0.4232831906977431,
  -0.38922832884410014,
  -0.36283543261711854,
  -0.3910386660581675,
  -0.374710795122581,
  -0.07792895083845737,
  -0.07883250451655548,
  0.20600369006191538,
  0.22376321443036004,
  0.4992669010639022,
  0.5007330989360977
};
static double dX_right_tallest[13] = {
  0.000369602960438716,
  0.0008488281093252369,
  0.000814287944943787,
  0.0014508907696841227,
  0.0018876479743716985,
  0.003807429643623959,
  0.006508639799815436,
  0.0006244638639581679,
  0.000725281906421875,
  0.0006403714291836312,
  0.0010103645153191365,
  0.000751416948910298,
  0.0018031553648707281
};
static double dY_right_tallest[13] = {
  1.357943825195068e-33,
  0.0003811935888427036,
  0.00022144106565603224,
  0.0011840798904368902,
  0.0018369394663623748,
  0.0016860926731368678,
  0.0021728987247927006,
  0.000335548996834216,
  0.00034496489416800186,
  0.0002336021454156936,
  0.0003193575314451231,
  6.0970814924971214e-05,
  6.097081492497131e-05
};
static double meansX_right_lowest[13] = {
  -0.03398863681206247,
  -0.12613653450459908,
  0.11468345908014711,
  -0.023105997758908356,
  0.161400883152258,
  0.09632893041368734,
  0.16083769423236566,
  0.0337009584783415,
  0.1819263220031196,
  -0.012575281732737252,
  0.21746801845145808,
  -0.15999253408063305,
  0.22796980770475792
};
static double meansY_right_lowest[13] = {
  -0.5,
  -0.3835198155984586,
  -0.5217719420891408,
  -0.19256191397300637,
  -0.30345736573232635,
  -0.06896218836174065,
  -0.11335474498870875,
  -0.07959858307935311,
  -0.09491089279498599,
  0.2212334403978979,
  0.2097942096409463,
  0.4929759122457073,
  0.5070240877542925
};
static double dX_right_lowest[13] = {
  0.0005569252421777565,
  0.0005343841104904081,
  0.0007378774835817669,
  0.001295231213775132,
  0.000900744697596744,
  0.0039014179764459444,
  0.003508867489486992,
  0.0007145359362524992,
  0.000627646893364642,
  0.0011386551930669087,
  0.0009447338525669017,
  0.0017489304613396337,
  0.001321632702399753
};
static double dY_right_lowest[13] = {
  9.923435645656265e-34,
  0.0003881391832315532,
  0.0005009417777172586,
  0.0009984104035636898,
  0.0015159134409032061,
  0.005530241600326495,
  0.006041315956531678,
  0.002249220258957187,
  0.002090612969726958,
  0.0025713432030445437,
  0.002653006629773378,
  0.00021403142133960356,
  0.0002140314213396035
};
//向右挥杆结束动作
static double meansX_right_complete[13] = {
    0.04174232179214418,
    0.11385588968128399,
    -0.03453437460896231,
    0.07157492996264961,
    -0.11491844885092958,
    -0.03552345499439226,
    -0.1014634026347667,
    0.08126612942995161,
    0.07348597181173244,
    -0.005834911288265784,
    0.10929026765639933,
    -0.20374510512574656,
    0.12026046154145821
};
static double meansY_right_complete[13] = {
    -0.5,
    -0.4591882261195559,
    -0.4404507963935443,
    -0.5173888588737195,
    -0.44591371225700394,
    -0.5759608363061162,
    -0.5609573543192443,
    -0.04002297009070049,
    -0.04119485685902772,
    0.2465235902117685,
    0.23996630072946926,
    0.47382608824113076,
    0.5261739117588692
};
static double dX_right_complete[13] = {
    0.0005669261481975038,
    0.003618391376472069,
    0.003309142300502765,
    0.01329226455431761,
    0.01562939914970904,
    0.0111772039032749,
    0.01575257681728855,
    0.0007866017097211,
    0.002263061009009542,
    0.0018915986967191108,
    0.0012342968635179143,
    0.001613544521294977,
    0.0011544229715351835
};
static double dY_right_complete[13] = {
    1.5146296511791144e-33,
    0.0004957333195832466,
    0.0004521896029904999,
    0.0052023868248528915,
    0.007894308179846817,
    0.005447621415998662,
    0.009559290714587412,
    0.0003610590742197841,
    0.00042969449694088395,
    0.00015740600078636537,
    0.0002534199286363875,
    9.966666571139892e-05,
    9.966666571139884e-05
};

@protocol HumanBodyPoseDetectorDelegate;

@interface HumanBodyPoseDetector : NSObject

@property(nonatomic,weak) id<HumanBodyPoseDetectorDelegate> delegate;
@property(nonatomic,assign) BOOL isFront;
@property(nonatomic,assign) AutoRecordStage currentStage;

- (void)predict:(CMSampleBufferRef)sampleBuffer isAutoRecord:(BOOL)isAuto;
- (void)detectionInitialize;
- (void)cancelAutoRecord;
@end

@protocol HumanBodyPoseDetectorDelegate<NSObject>

@optional
//- (void)getPersonViewRect:(CGRect)rect;
- (void)hidePersonView;
- (void)autoRecordReady;
- (void)autoRecordNotReady;
- (void)autoRecordBegin;
- (void)autoRecordWillFinish;
- (void)autoRecordFinishedWith:(NSTimeInterval)interval;
- (void)autoRecordEndByTime;

@end

NS_ASSUME_NONNULL_END
